Option Explicit

Sub CopySupplierTablesWithFormat()
    Dim OutlookApp As Object
    Dim OutlookNamespace As Object
    Dim OutlookFolder As Object
    Dim OutlookMail As Object
    Dim Inspector As Object
    Dim WordEditor As Object
    Dim TableObj As Object
    Dim ExcelRow As Long
    Dim HeaderText As String
    Dim FoundValid As Boolean
    
    ' Start position in Excel
    ExcelRow = 2
    
    ' Connect to Outlook
    Set OutlookApp = CreateObject("Outlook.Application")
    Set OutlookNamespace = OutlookApp.GetNamespace("MAPI")
    
    ' ðŸ“Œ Change to your correct folder
    Set OutlookFolder = OutlookNamespace.Folders("YourEmail@domain.com").Folders("Inbox").Folders("Supplier Replies")
    
    ' Loop through emails
    For Each OutlookMail In OutlookFolder.Items
        If OutlookMail.Class = 43 Then ' MailItem
            
            ' Open mail in hidden WordEditor (Outlook uses Word for rendering)
            Set Inspector = OutlookMail.GetInspector
            Set WordEditor = Inspector.WordEditor
            
            FoundValid = False
            
            ' Loop through tables inside the mail
            For Each TableObj In WordEditor.Tables
                ' Check first row text to identify correct table
                HeaderText = LCase(Trim(TableObj.Rows(1).Range.Text))
                
                If InStr(HeaderText, "field") > 0 _
                   And InStr(HeaderText, "current information") > 0 _
                   And InStr(HeaderText, "changed") > 0 Then
                   
                    ' âœ… Copy the whole table
                    TableObj.Range.Copy
                    
                    ' Paste into Excel, keeping formatting
                    ThisWorkbook.Sheets(1).Cells(ExcelRow, 1).Select
                    ThisWorkbook.Sheets(1).Paste
                    
                    ExcelRow = ThisWorkbook.Sheets(1).Cells(Rows.Count, 1).End(xlUp).Row + 2 ' Move below last row
                    FoundValid = True
                    Exit For
                End If
            Next TableObj
            
            ' If no valid table found
            If Not FoundValid Then
                ThisWorkbook.Sheets(1).Cells(ExcelRow, 1).Value = "âš  No valid table found for: " & OutlookMail.SenderEmailAddress
                ExcelRow = ExcelRow + 2
            End If
        End If
    Next OutlookMail
    
    MsgBox "âœ… Done! Tables copied with formatting."
End Sub
