Option Explicit

Sub ExtractTablesFromOutlook()
    Dim OutlookApp As Object
    Dim OutlookNamespace As Object
    Dim OutlookFolder As Object
    Dim OutlookMail As Object
    Dim HTMLDoc As Object
    Dim TableElement As Object
    Dim RowElement As Object
    Dim CellElement As Object
    Dim ExcelRow As Long
    Dim ExcelCol As Long
    
    ' Start row in Excel
    ExcelRow = 2
    
    ' Connect to Outlook
    Set OutlookApp = CreateObject("Outlook.Application")
    Set OutlookNamespace = OutlookApp.GetNamespace("MAPI")
    
    ' ðŸ“Œ Change "Supplier Replies" to your Outlook folder name
    Set OutlookFolder = OutlookNamespace.Folders("YourEmail@domain.com").Folders("Inbox").Folders("Supplier Replies")
    
    ' Loop through each email
    For Each OutlookMail In OutlookFolder.Items
        If OutlookMail.Class = 43 Then ' 43 = MailItem
            ' Load HTML body
            Set HTMLDoc = CreateObject("HTMLFile")
            HTMLDoc.body.innerHTML = OutlookMail.HTMLBody
            
            ' Find the first table
            For Each TableElement In HTMLDoc.getElementsByTagName("table")
                ' Loop through rows
                For Each RowElement In TableElement.Rows
                    ExcelCol = 1
                    For Each CellElement In RowElement.Cells
                        ThisWorkbook.Sheets(1).Cells(ExcelRow, ExcelCol).Value = Trim(CellElement.innerText)
                        ExcelCol = ExcelCol + 1
                    Next CellElement
                    ExcelRow = ExcelRow + 1
                Next RowElement
                
                ' Add a blank row between different mails
                ExcelRow = ExcelRow + 1
                
                Exit For ' Take only first table from each mail
            Next TableElement
        End If
    Next OutlookMail
    
    MsgBox "âœ… Done! Tables extracted to Excel."
End Sub
